<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Lilliput Castle, Lansdown, Bath - John Wood the Elder (1704-1754)</title><meta name="description" content="Lilliput Castle (now known as Battfields House) was built for Jeremiah (Jerry) Peirce based on design by John Wood the Elder."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://www.georgianbath.co.uk/lilliput-castle-lansdown-bath/"><link rel="alternate" type="application/atom+xml" href="https://www.georgianbath.co.uk/feed.xml"><link rel="alternate" type="application/json" href="https://www.georgianbath.co.uk/feed.json"><meta property="og:title" content="Lilliput Castle, Lansdown, Bath"><meta property="og:image" content="https://www.georgianbath.co.uk/media/posts/26/lilliput-castle-battlefields-house-bath.jpeg"><meta property="og:image:width" content="920"><meta property="og:image:height" content="613"><meta property="og:site_name" content="John Wood the Elder (1704-1754)"><meta property="og:description" content="Lilliput Castle (now known as Battfields House) was built for Jeremiah (Jerry) Peirce based on design by John Wood the Elder."><meta property="og:url" content="https://www.georgianbath.co.uk/lilliput-castle-lansdown-bath/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@johnwoodelder"><meta name="twitter:title" content="Lilliput Castle, Lansdown, Bath"><meta name="twitter:description" content="Lilliput Castle (now known as Battfields House) was built for Jeremiah (Jerry) Peirce based on design by John Wood the Elder."><meta name="twitter:image" content="https://www.georgianbath.co.uk/media/posts/26/lilliput-castle-battlefields-house-bath.jpeg"><link rel="shortcut icon" href="https://www.georgianbath.co.uk/media/website/favicon.ico" type="image/x-icon"><link rel="shortcut icon" href="https://www.georgianbath.co.uk/media/website/favicon.ico" type="image/x-icon"><link rel="preload" href="https://www.georgianbath.co.uk/assets/dynamic/fonts/domine/domine.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://www.georgianbath.co.uk/assets/css/style.css?v=07d0311903be26693ef47008752fc530"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.georgianbath.co.uk/lilliput-castle-lansdown-bath/"},"headline":"Lilliput Castle, Lansdown, Bath","datePublished":"1738-05-14T07:04","dateModified":"2023-05-14T09:33","image":{"@type":"ImageObject","url":"https://www.georgianbath.co.uk/media/posts/26/lilliput-castle-battlefields-house-bath.jpeg","height":613,"width":920},"description":"Lilliput Castle (now known as Battfields House) was built for Jeremiah (Jerry) Peirce based on design by John Wood the Elder.","author":{"@type":"Person","name":"John Wood","url":"https://www.georgianbath.co.uk/authors/john-wood/"},"publisher":{"@type":"Organization","name":"John Wood"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><meta name="ahrefs-site-verification" content="57a998b0ae3ff40e0d2b8c0e839d954c3eef2a73946bd179073b716a2c6683bd"></head><body><header class="header" id="js-header"><a href="https://www.georgianbath.co.uk/" class="logo">John Wood the Elder (1704-1754)</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://www.georgianbath.co.uk/tags/news/" target="_self">News</a></li><li class="has-submenu"><a href="https://www.georgianbath.co.uk/tags/" target="_self" aria-haspopup="true">Buildings</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://www.georgianbath.co.uk/tags/john-wood-the-elder-buildings/" target="_self">John Wood the Elder Buildings</a></li><li><a href="https://www.georgianbath.co.uk/tags/john-wood-the-younger-buildings/" target="_self">John Wood the Younger Buildings</a></li></ul></li><li><a href="https://www.georgianbath.co.uk/tags/publication/" target="_self">Publications</a></li><li><a href="https://www.georgianbath.co.uk/timeline/" target="_self">Timeline</a></li><li><a href="https://www.georgianbath.co.uk/map/" target="_self">Map</a></li><li class="has-submenu"><a href="https://www.georgianbath.co.uk/#" target="_self" aria-haspopup="true">Misc</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://www.georgianbath.co.uk/#" target="_self">Bibliography</a></li><li><a href="https://www.georgianbath.co.uk/#" target="_self">Links</a></li><li><a href="https://www.georgianbath.co.uk/privacy-policy/" target="_self">Privicy Policy</a></li></ul></li><li><a href="https://www.georgianbath.co.uk/about/" target="_self">About</a></li><li><a href="mailto:admin@johnwoodtheelder.co.uk" target="_self">Contact</a></li></ul></nav></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://www.georgianbath.co.uk/tags/john-wood-the-elder-buildings/" class="post__maintag">John Wood the Elder Buildings</a><h1 class="post__title">Lilliput Castle, Lansdown, Bath</h1></header><figure class="post__featured-image"><img src="https://www.georgianbath.co.uk/media/posts/26/lilliput-castle-battlefields-house-bath.jpeg" srcset="https://www.georgianbath.co.uk/media/posts/26/responsive/lilliput-castle-battlefields-house-bath-xs.jpeg 300w, https://www.georgianbath.co.uk/media/posts/26/responsive/lilliput-castle-battlefields-house-bath-sm.jpeg 480w, https://www.georgianbath.co.uk/media/posts/26/responsive/lilliput-castle-battlefields-house-bath-md.jpeg 768w, https://www.georgianbath.co.uk/media/posts/26/responsive/lilliput-castle-battlefields-house-bath-lg.jpeg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="eager" height="613" width="920" alt="Lilliput Castle, Lansdown, Bath"><figcaption>Lilliput Castle, Lansdown, Bath | Lilliput Castle, Bath now known as Battlefields House photo from Country Life Magazine</figcaption></figure><div class="post__inner"><div class="post__entry"><h2>Architect: John Wood the Elder</h2><h3>Date: 1738</h3><h3>Description:</h3><p>Lilliput Castle (now known as Battfields House) was built for Jeremiah (Jerry) Peirce based on design by John Wood the Elder.</p><p>In his ‘A Description of Bath’ John Wood describes the building:</p><blockquote><p class="sqsrte-small"><strong>Lilliput, consists of a Cellar Story, almost sunk into the Earth, and this sustains a Principal and half Story, where in there is a Hall and a Dining Parlour ; an Alcove Bed Chamber, with a light Closet ; and a Room sufficient for holding a second Bed : The lower Story yields proper Cellars, a Pantry, and a Kitchen ; and the Precept of Convenience may be very justly said to shine so eminently in every Part of this little Box as to render it the Multum in Parvo of all Bath.</strong></p><p class="sqsrte-small"><strong>The Windows in the Westward Front are dressed with Architraves ; and those of the principal Story are crowned with Freezes and Cornices, the central Window having the Addition of a Pediment to distinguish it: All the Ornaments were intended to have been such as were proper to the Dorick Order; and the Building being crowned with an Entablatures the whole was at first covered with a Pyramidal Roof ; in the Center of which the Funnels of the Chimneys rose up in a small Pedestal.</strong></p></blockquote><figure class="post__image"><img loading="lazy" src="https://www.georgianbath.co.uk/media/posts/26/lilliput-castle.png" alt="" width="553" height="686" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://www.georgianbath.co.uk/media/posts/26/responsive/lilliput-castle-xs.png 300w, https://www.georgianbath.co.uk/media/posts/26/responsive/lilliput-castle-sm.png 480w, https://www.georgianbath.co.uk/media/posts/26/responsive/lilliput-castle-md.png 768w"><figcaption>Designed by John Wood the Elder from ‘A Description of Bath’</figcaption></figure><p>For more information about Lilliput Castle and Jeremiah (Jerry) Peirce check out the excellent article ‘<a href="https://link.johnwoodtheelder.co.uk/HoBJP" target="_blank" rel="noopener"><em>For True Friends: Jerry Peirce's Patriot Whig Garden at Lilliput Castle</em></a>’ by Cathryn Spence from <a href="https://link.johnwoodtheelder.co.uk/HoB" target="_blank" rel="noopener">Bath History Volume XII - 2011</a></p><h2>Location:</h2><ul><li>Grid Reference: ST 72482 70574</li><li>Latitude, Longitude (degs, mins, secs): 51°26′01″N , 002°23′50″W</li><li>What3Words: <a href="https://w3w.co/hangs.stunt.good" target="_blank" rel="noopener noreferrer">hangs.stunt.good</a></li><li>QR:<figure class="post__image"><img loading="lazy" src="https://www.georgianbath.co.uk/media/posts/26/lilliput-castle-qr.png" alt="Lilliput Castle, Lansdown, Bath QR" width="230" height="230" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://www.georgianbath.co.uk/media/posts/26/responsive/lilliput-castle-qr-xs.png 300w, https://www.georgianbath.co.uk/media/posts/26/responsive/lilliput-castle-qr-sm.png 480w, https://www.georgianbath.co.uk/media/posts/26/responsive/lilliput-castle-qr-md.png 768w"></figure></li></ul><div class="post__iframe"><iframe width="600" height="450" style="border: 0;" src="https://www.google.com/maps/embed?pb=!1m17!1m12!1m3!1d2487.343188732794!2d-2.3995028842327555!3d51.433490979623016!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m2!1m1!2zNTHCsDI2JzAwLjYiTiAywrAyMyc1MC4zIlc!5e0!3m2!1sen!2suk!4v1684044580453!5m2!1sen!2suk" allowfullscreen="allowfullscreen" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div><p> </p></div><footer><div class="post__tags-share"><ul class="post__tag"><li><a href="https://www.georgianbath.co.uk/tags/john-wood-the-elder-buildings/">John Wood the Elder Buildings</a></li></ul><aside class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.georgianbath.co.uk%2Flilliput-castle-lansdown-bath%2F" class="js-share facebook" aria-label="Share with Facebook" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://www.georgianbath.co.uk/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fwww.georgianbath.co.uk%2Flilliput-castle-lansdown-bath%2F&amp;via=John%20Wood%20the%20Elder%20(1704-1754)&amp;text=Lilliput%20Castle%2C%20Lansdown%2C%20Bath" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://www.georgianbath.co.uk/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fwww.georgianbath.co.uk%2Flilliput-castle-lansdown-bath%2F&amp;media=https%3A%2F%2Fwww.georgianbath.co.uk%2Fmedia%2Fposts%2F26%2Flilliput-castle-battlefields-house-bath.jpeg&amp;description=Lilliput%20Castle%2C%20Lansdown%2C%20Bath" class="js-share pinterest" aria-label="Share with Pinterest" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://www.georgianbath.co.uk/assets/svg/svg-map.svg#pinterest"/></svg></a></aside></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://www.georgianbath.co.uk/royal-mineral-water-hospital-bath/" rel="prev">Previous Post<h3 class="h6">Royal Mineral Water Hospital, Bath</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://www.georgianbath.co.uk/ralph-allen-cottages/" rel="prev">Next Post<h3 class="h6">Ralph Allen Cottages</h3></a></div></nav></footer></div></article></div><div class="post__related"><div class="wrapper"><h2 class="h5">Related posts</h2><div class="l-grid l-grid--4"><article class="c-card"><a href="https://www.georgianbath.co.uk/bathford-spaw/" class="c-card__image"><img src="https://www.georgianbath.co.uk/media/posts/28/bathford-spaw.png" srcset="https://www.georgianbath.co.uk/media/posts/28/responsive/bathford-spaw-xs.png 300w, https://www.georgianbath.co.uk/media/posts/28/responsive/bathford-spaw-sm.png 480w, https://www.georgianbath.co.uk/media/posts/28/responsive/bathford-spaw-md.png 768w, https://www.georgianbath.co.uk/media/posts/28/responsive/bathford-spaw-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="1371" width="1000" alt="Bathford Spaw"></a><div class="c-card__wrapper"><header class="c-card__header"><h3 class="c-card__title"><a href="https://www.georgianbath.co.uk/bathford-spaw/" class="invert">Bathford Spaw</a></h3></header></div></article><article class="c-card"><a href="https://www.georgianbath.co.uk/titanbarrow-logia-bathford/" class="c-card__image"><img src="https://www.georgianbath.co.uk/media/posts/27/titan-barrow.jpeg" srcset="https://www.georgianbath.co.uk/media/posts/27/responsive/titan-barrow-xs.jpeg 300w, https://www.georgianbath.co.uk/media/posts/27/responsive/titan-barrow-sm.jpeg 480w, https://www.georgianbath.co.uk/media/posts/27/responsive/titan-barrow-md.jpeg 768w, https://www.georgianbath.co.uk/media/posts/27/responsive/titan-barrow-lg.jpeg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="1500" width="1500" alt="Titanbarrow Logia, Bathford"></a><div class="c-card__wrapper"><header class="c-card__header"><h3 class="c-card__title"><a href="https://www.georgianbath.co.uk/titanbarrow-logia-bathford/" class="invert">Titanbarrow Logia, Bathford</a></h3></header></div></article></div></div></div></main><footer class="footer"><div class="footer__copyright">&copy; 2023 johnwoodtheelder.co.uk</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://www.georgianbath.co.uk/assets/js/scripts.min.js?v=66112a161d5939d966ce2b20c13988d9"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner pcb__banner--left"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">This website uses cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="https://www.georgianbath.co.uk/privacy-policy/">More details...</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--link pcb__btn--configure" aria-haspopup="dialog">Manage preferences</button> <button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button></div></div></div><div class="pcb__popup" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-popup-title"><div class="pcb__popup__wrapper"><div class="pcb__inner pcb__popup__inner"><div class="pcb__popup__heading"><div id="pcb-popup-title" role="heading" aria-level="2" class="pcb__title">Cookie settings</div><button class="pcb__popup__close" aria-label="Close"></button></div><div class="pcb__popup__content"><div class="pcb__txt pcb__popup__txt">We use cookies to enhance your browsing experience, serve personalized ads or content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies. <a href="https://www.georgianbath.co.uk/privacy-policy/">More details...</a></div><ul class="pcb__groups"><li class="pcb__group"><details><summary class="pcb__group__title no-desc">Required</summary></details><div class="pcb__popup__switch is-checked"><input type="checkbox" data-group-name="" id="pcb-group-0" checked="checked"> <label for="pcb-group-0">Required</label></div></li></ul></div><div class="pcb__buttons pcb__popup__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject all</button> <button type="button" class="pcb__btn pcb__btn--save">Save settings</button></div></div></div></div><div class="pcb__overlay" aria-hidden="true"></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>